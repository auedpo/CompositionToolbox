<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interval Placement Lab</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="hero-text">
        <p class="eyebrow">Interval Placement Lab</p>
        <h1>Vertical interval placement + tension scoring</h1>
        <p class="subhead">Explore permutations across window sizes and EDOs with live ranking and visual layout.</p>
      </div>
      <div class="hero-badge">v1</div>
    </header>

    <section class="panel control-panel">
      <div class="field">
        <label for="intervals" title="Comma or space-separated interval sizes in steps. These are the d[i] values that stay fixed through placement and quantization.">Intervals (steps)</label>
        <input id="intervals" type="text" value="11, 7, 16" title="Comma or space-separated interval sizes in steps. These are the d[i] values that stay fixed through placement and quantization." />
        <p class="hint">Comma or space separated. Example: 11, 7, 16</p>
      </div>
      <details class="config-fold">
        <summary>Config & MIDI</summary>
        <div class="config-body">
          <div class="config-section">
            <div class="config-title">Bias + Orientation</div>
            <div class="field">
              <label title="Controls which side gets the extra step for odd intervals. This affects quantization (Q) only, not the continuous placement. Use it to flip individual columns.">Odd interval bias (per column)</label>
              <div id="oddBias" class="odd-bias"></div>
              <p class="hint">Flip odd intervals between down-bias and up-bias. Even intervals are fixed.</p>
            </div>
          </div>
          <div class="config-section">
            <div class="config-title">Window + Display</div>
            <div class="field-row">
              <div class="field">
                <label for="edo" title="Steps per octave used for tuning and tension calculations. This does not change interval sizes; it changes how they are interpreted for pitch and cost.">N-EDO</label>
                <input id="edo" type="number" min="1" value="12" title="Steps per octave used for tuning and tension calculations. This does not change interval sizes; it changes how they are interpreted for pitch and cost." />
              </div>
              <div class="field">
                <label for="baseNote" title="Root note used only for pitch-name rendering. It does not affect placement or scoring.">Base note</label>
                <select id="baseNote" title="Root note used only for pitch-name rendering. It does not affect placement or scoring.">
                  <option value="0">C</option>
                  <option value="1">C#</option>
                  <option value="2">D</option>
                  <option value="3">D#</option>
                  <option value="4">E</option>
                  <option value="5">F</option>
                  <option value="6">F#</option>
                  <option value="7">G</option>
                  <option value="8">G#</option>
                  <option value="9">A</option>
                  <option value="10">A#</option>
                  <option value="11">B</option>
                </select>
              </div>
              <div class="field">
                <label for="baseOctave" title="Octave for the base note used in pitch-name display. This does not affect placement or scoring.">Base octave</label>
                <input id="baseOctave" type="number" value="4" title="Octave for the base note used in pitch-name display. This does not affect placement or scoring." />
              </div>
              <div class="field">
                <label for="minO" title="Smallest window height in octaves to evaluate. Results are computed for each O between min and max.">Min octaves</label>
                <input id="minO" type="number" min="1" value="2" title="Smallest window height in octaves to evaluate. Results are computed for each O between min and max." />
              </div>
              <div class="field">
                <label for="maxO" title="Largest window height in octaves to evaluate. Use a bigger range to compare how placement changes with L.">Max octaves</label>
                <input id="maxO" type="number" min="1" value="4" title="Largest window height in octaves to evaluate. Use a bigger range to compare how placement changes with L." />
              </div>
              <div class="field">
                <label for="xSpacing" title="Horizontal spread for plotting permutations. This changes only the visual spacing, not the underlying placement.">X spacing</label>
                <input id="xSpacing" type="number" min="0.1" step="0.1" value="0.8" title="Horizontal spread for plotting permutations. This changes only the visual spacing, not the underlying placement." />
              </div>
            </div>
          </div>
          <div class="config-section">
            <div class="config-title">Placement Parameters</div>
            <div id="placementParams" class="field-row"></div>
          </div>
          <div class="config-section">
            <div class="config-title">Damping + MIDI</div>
            <div class="field-row">
              <div class="field">
                <label for="useDamping" title="Applies a register-dependent weight so lower-register dyads contribute more to tension. This affects scoring only, not placement.">Register damping</label>
                <select id="useDamping" title="Applies a register-dependent weight so lower-register dyads contribute more to tension. This affects scoring only, not placement.">
                  <option value="on">On</option>
                  <option value="off">Off</option>
                </select>
              </div>
              <div class="field">
                <label for="midiOut" title="Select a MIDI device for preview playback. This does not affect scoring or placement.">MIDI output</label>
                <select id="midiOut" title="Select a MIDI device for preview playback. This does not affect scoring or placement.">
                  <option value="">No device</option>
                </select>
                <p class="hint">Requires browser permission. Chromium-based browsers only.</p>
              </div>
              <div class="field">
                <label>&nbsp;</label>
                <button id="midiPreview" type="button" title="Plays the selected permutation through the chosen MIDI device. This is a preview only and does not change any state.">Preview selected</button>
              </div>
            </div>
            <div id="midiParams" class="field-row"></div>
          </div>
          <div class="config-section">
            <div class="config-title">Guitar</div>
            <div class="field-row">
              <div class="field">
                <label for="guitarTuning" title="Guitar tuning as note names, e.g. EADGBE or E A D G B E. Used for the fretboard visualization only. This does not affect placement or scoring.">Tuning</label>
                <input id="guitarTuning" type="text" value="EADGBE" title="Guitar tuning as note names, e.g. EADGBE or E A D G B E. Used for the fretboard visualization only. This does not affect placement or scoring." />
              </div>
            </div>
          </div>
          <div class="actions">
            <button id="runBtn" title="Recompute all permutations with the current settings. This recalculates placement, quantization, and tension.">Recompute</button>
            <span id="status" class="status">Ready</span>
          </div>
        </div>
      </details>
    </section>

    <section class="layout-grid">
      <div class="panel layout-panel">
        <div class="layout-header">
          <h2>Permutation layout</h2>
          <div class="tab-controls">
            <div class="field compact">
              <label for="placementMode" title="Select the placement engine that chooses continuous centers. All modes share rho orientation, quantization, and scoring downstream.">Placement</label>
              <select id="placementMode" title="Select the placement engine that chooses continuous centers. All modes share rho orientation, quantization, and scoring downstream.">
                <option value="v1">v1 (legacy)</option>
                <option value="v2">v2 (alpha-beta)</option>
                <option value="repulse">A (center repulsion)</option>
              </select>
            </div>
            <div id="tabBar" class="tabs"></div>
          </div>
        </div>
        <div class="layout-body">
          <div class="plot-stack">
            <div class="plot-wrap">
              <canvas id="plot" width="640" height="720"></canvas>
            </div>
            <div class="meta-card">
              <h3>Keyboard</h3>
              <div id="keyboard" class="keyboard"></div>
            </div>
            <div class="meta-card">
              <h3>Fretboard</h3>
              <div id="fretboard" class="fretboard"></div>
            </div>
          </div>
          <div class="plot-meta">
            <div class="meta-card">
              <h3>Selected permutation</h3>
              <div id="selectedInfo" class="meta-lines"></div>
            </div>
            <div class="meta-card">
              <h3>Hover dyads</h3>
              <div id="hoverInfo" class="meta-lines"></div>
            </div>
            <div class="meta-card anchor-math">
              <h3>Anchor math</h3>
              <div id="anchorMath" class="meta-lines small"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel table-panel">
        <div class="table-header">
          <div>
            <h2>Ranked results</h2>
            <p id="anchorSummary" class="hint"></p>
          </div>
          <div class="filter">
            <label for="filter">Filter</label>
            <input id="filter" type="text" placeholder="perm or pitch" />
          </div>
        </div>
        <div class="table-wrap">
          <table id="resultsTable">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Permutation</th>
                <th>Pitches</th>
                <th>Fav</th>
                <th>Total</th>
                <th>Per pair</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      <div class="meta-card">
          <h3>Favorites</h3>
          <div id="favoritesList" class="meta-lines"></div>
        </div>
      </div>
    </section>
  </div>

  <div id="favoritePrompt" class="modal hidden">
    <div class="modal-card">
      <h3>Favorite settings</h3>
      <p id="favoritePromptText" class="modal-text"></p>
      <div class="modal-actions">
        <button id="favoriteSwitchBtn" type="button">Switch to favorite settings</button>
        <button id="favoriteImportBtn" type="button">Import intervals only</button>
        <button id="favoriteCancelBtn" type="button" class="ghost">Cancel</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
