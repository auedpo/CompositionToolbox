<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interval Placement Lab</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page">
    <header class="hero">
      <div class="hero-text">
        <p class="eyebrow">Interval Placement Lab</p>
        <h1>Vertical interval placement + tension scoring</h1>
        <p class="subhead">Explore permutations across window sizes and EDOs with live ranking and visual layout.</p>
      </div>
      <div class="hero-badge">v1</div>
    </header>

    <section class="panel control-panel">
      <div class="field">
        <label for="intervals">Intervals (steps)</label>
        <input id="intervals" type="text" value="11, 7, 16" />
        <p class="hint">Comma or space separated. Example: 11, 7, 16</p>
      </div>
      <details class="config-fold">
        <summary>Config & MIDI</summary>
        <div class="config-body">
          <div class="field">
            <label>Odd interval bias (per column)</label>
            <div id="oddBias" class="odd-bias"></div>
            <p class="hint">Flip odd intervals between down-bias and up-bias. Even intervals are fixed.</p>
          </div>
          <div class="field-row">
            <div class="field">
              <label for="edo">N-EDO</label>
              <input id="edo" type="number" min="1" value="12" />
            </div>
            <div class="field">
              <label for="placementMode">Placement mode</label>
              <select id="placementMode">
                <option value="v1">v1 (legacy)</option>
                <option value="v2">v2 (parametric)</option>
              </select>
            </div>
            <div class="field">
              <label for="baseNote">Base note</label>
              <select id="baseNote">
                <option value="0">C</option>
                <option value="1">C#</option>
                <option value="2">D</option>
                <option value="3">D#</option>
                <option value="4">E</option>
                <option value="5">F</option>
                <option value="6">F#</option>
                <option value="7">G</option>
                <option value="8">G#</option>
                <option value="9">A</option>
                <option value="10">A#</option>
                <option value="11">B</option>
              </select>
            </div>
            <div class="field">
              <label for="baseOctave">Base octave</label>
              <input id="baseOctave" type="number" value="4" />
            </div>
            <div class="field">
              <label for="minO">Min octaves</label>
              <input id="minO" type="number" min="1" value="2" />
            </div>
            <div class="field">
              <label for="maxO">Max octaves</label>
              <input id="maxO" type="number" min="1" value="4" />
            </div>
            <div class="field">
              <label for="xSpacing">X spacing</label>
              <input id="xSpacing" type="number" min="0.1" step="0.1" value="0.8" />
            </div>
          </div>
          <div class="field-row">
            <div class="field">
              <label for="anchorAlpha">Anchor alpha (0..1)</label>
              <input id="anchorAlpha" type="number" min="0" max="1" step="0.05" value="0.3" />
            </div>
            <div class="field">
              <label for="anchorBeta">Anchor beta (>=0)</label>
              <input id="anchorBeta" type="number" min="0" step="0.1" value="1.0" />
            </div>
            <div class="field">
              <label for="anchorRho">Anchor rho (0..1)</label>
              <input id="anchorRho" type="number" min="0" max="1" step="0.05" value="0.5" />
            </div>
          </div>
          <div class="field-row">
            <div class="field">
              <label for="useDamping">Register damping</label>
              <select id="useDamping">
                <option value="on">On</option>
                <option value="off">Off</option>
              </select>
            </div>
            <div class="field">
              <label for="midiOut">MIDI output</label>
              <select id="midiOut">
                <option value="">No device</option>
              </select>
              <p class="hint">Requires browser permission. Chromium-based browsers only.</p>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button id="midiPreview" type="button">Preview selected</button>
            </div>
          </div>
          <div class="actions">
            <button id="runBtn">Recompute</button>
            <span id="status" class="status">Ready</span>
          </div>
        </div>
      </details>
    </section>

    <section class="layout-grid">
      <div class="panel layout-panel">
        <div class="layout-header">
          <h2>Permutation layout</h2>
          <div id="tabBar" class="tabs"></div>
        </div>
        <div class="layout-body">
          <div class="plot-stack">
            <div class="plot-wrap">
              <canvas id="plot" width="640" height="720"></canvas>
            </div>
            <div class="meta-card anchor-math">
              <h3>Anchor math</h3>
              <div id="anchorMath" class="meta-lines small"></div>
            </div>
          </div>
          <div class="plot-meta">
            <div class="meta-card">
              <h3>Selected permutation</h3>
              <div id="selectedInfo" class="meta-lines"></div>
            </div>
            <div class="meta-card">
              <h3>Hover dyads</h3>
              <div id="hoverInfo" class="meta-lines"></div>
            </div>
            <div class="meta-card">
              <h3>Favorites</h3>
              <div id="favoritesList" class="meta-lines"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="panel table-panel">
        <div class="table-header">
          <div>
            <h2>Ranked results</h2>
            <p id="anchorSummary" class="hint"></p>
          </div>
          <div class="filter">
            <label for="filter">Filter</label>
            <input id="filter" type="text" placeholder="perm or pitch" />
          </div>
        </div>
        <div class="table-wrap">
          <table id="resultsTable">
            <thead>
              <tr>
                <th>Rank</th>
                <th>Permutation</th>
                <th>Pitches</th>
                <th>Fav</th>
                <th>Total</th>
                <th>Per pair</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
    </section>
  </div>

  <script src="app.js"></script>
</body>
</html>
